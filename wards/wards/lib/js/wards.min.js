"use strict";$(function(){var e={};$.getJSON("wards.json",function(a){e.packagePrice=a[0].packagePrice,e.packageSize=a[0].packageSize,e.paidPackages=a[0].paidPackages,e.paidStudents=a[0].paidStudents,e.paidPhrase="&nbsp;&nbsp;<span style='font-size: 10px; vertical-align: top; margin-top:5px;' class='badge alert-info'>есть оплаченные </span>",e.allPaidPhrase="&nbsp;&nbsp;<span style='font-size: 10px; vertical-align: top; margin-top:5px;' class='badge alert-success'>все оплачены </span>",0!=e.paidPackages?e.rest=e.paidPackages*e.packageSize-e.paidStudents:e.rest=e.packageSize-e.paidStudents,$("#packagePrice").text(e.packagePrice),$("#packageSize").text(e.packageSize),$("#paidPackages").text(e.paidPackages),$("#paidStudents").text(e.paidStudents),$("#restWards").text(e.rest),$("#students").jstree({plugins:["checkbox"],checkbox:{whole_node:!1,tie_selection:!1,cascade:"up+undetermined",three_state:!0},core:{data:i(a),themes:{name:"proton",responsive:!1}},types:{types:{disabled:{check_node:!1,uncheck_node:!1}}}}).bind("loaded.jstree",function(a,t){getChecked(!1,e),$(".badge").show()}).on("check_node.jstree uncheck_node.jstree",function(a,t){t.node.text.indexOf("добавлен")+1||getChecked(!1,e),$(".badge").show()})});var a=function(a){var t=0;return a.map(function(e){"undefined"!=typeof e.classEntry&&e.classEntry.map(function(e){"undefined"!=typeof e.firstName&&e.paid&&t++})}),t?e.paidPhrase:""},t=function(a){var t=0;return a.classes.map(function(e){e.classEntry.map(function(e){0==e.paid&&t++})}),!t&&e.allPaidPhrase},s=function(a){var t=0;return a.map(function(e){e.classEntry.map(function(e){0==e.paid&&t++})}),!t&&e.allPaidPhrase},n=function(a,t){var s=0;return a.map(function(e){"undefined"!=typeof e.firstName&&e.paid&&s++}),s?a.length==s&&t?e.allPaidPhrase:e.paidPhrase:""},i=function(e){var i="[";return e.map(function(e){var r=1;e.organizations.map(function(c){var p=t(c);if(p)var d=p;else var d=a(c.classes);i+='{"text":"'+c.orgName+"  <span class='orginfo'>"+d+'</span>","children":[';var o=0,l=[],g="",u=[];c.classes.map(function(e){g="",l[e.classNumber]=[],l[e.classNumber].push(e),o++;var a=n(e.classEntry,!1);g=""!=a?a:"",u.push(g)});var f=1;l.map(function(e,a){if(p=s(e))var t=p;else var t=u[f-1];i+='{"text":"'+a+" классы <span class='parinfo'>"+t+'</span>","children":[';var r=1;e.map(function(a){i+='{"text":"'+a.classNumber+a.classSuffix+" <span class='classinfo'>"+n(a.classEntry,!0)+'</span>","children":[';var t=1;a.classEntry.map(function(e){if(e.paid)var s="<img style='margin: -4px 8px 0 -2px;' src='./wards/lib/img/user.png' />",n=" <span style='font-size: 10px; vertical-align: top; margin-top:5px;' class='badge alert-info'>добавлен(а) ранее </span> ";else var s="",n="";i+='{"text":" '+s+e.firstName+" "+e.lastName+" ["+e.id+"]"+n+'"',e.paid?(i+=', "icon": "./wards/lib/img/user_paid.png"',i+=',"a_attr": {"class": "no_checkbox"}',i+=',"state" : {"disabled":true}'):i+=', "icon": "./wards/lib/img/user.png"',i+="}",t!=a.classEntry.length&&(i+=","),t++}),i+="]",i+="}",r!=e.length&&(i+=","),r++}),i+="]",i+="}",f!=o&&(i+=","),f++}),i+="]",i+="}",r!=e.organizations.length&&(i+=","),r++})}),i+="]",JSON.parse(i)}});var getChecked=function(e,a){if(e){var t="\n\r\n\rИтого: "+$("#amount").text();alert(t)}else{var s=[],n=$("#students").jstree(!0).get_checked(!0).length-a.rest;if(n>0&&($(".alert-info").hide(),$(".alert-success").show()),$("#students").jstree(!0).get_checked(!0).map(function(e){if("string"==typeof e.icon&&e.icon.indexOf("user.png")+1){var a={};a.text=e.text,a.price=e.original.price,s.push(a)}}),s.length<a.rest&&($(".alert-info").show(),$(".alert-success").hide()),$(".count").text(s.length),a.rest>=s.length)$("#amount").text("0руб."),$("#restWards").text(a.rest-s.length);else if(s.length-a.rest>a.packageSize){var i=~~((s.length-a.rest)/a.packageSize)+1,r=i*a.packageSize-(s.length-a.rest);a.packageSize-r==0&&(i-=1),$("#packages").text(i),$("#amount").text(a.packagePrice*i+"руб."),$("#restСurWards").text(r)}else{var r=a.packageSize-(s.length-a.rest);$("#packages").text(1),$("#amount").text(a.packagePrice+"руб."),$("#restСurWards").text(r)}}};